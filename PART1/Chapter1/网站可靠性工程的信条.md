&emsp;虽然不同的SRE团队在工作流，事情的优先安排，每天的工作上各有不同，但他们对各自负责的服务有基本共同的责任，并坚守着相同的核心信条。整体来说，一个SRE团队会负责服务可用性，延迟率，性能，效率，配置管理，监控，紧急事故的处理，服务的规划。关于SRE团队怎样跟生产环境，产品开发团队，测试团队，用户等的沟通方式我们已经制定了一些原则和规定。这些规则和实践帮助我们把所有的注意力集中在工程而不是日常的手工琐事。下面我们逐一讨论。

#### 保证足够的精力在工程构建上

&emsp;之前我们已经讨论过，谷歌让SRE工程师把一般的时间安排在运维的工作上。剩下一半的时间用它们的编程技能来编写工程项目。实际上，这些是通过查看SRE工程师完成的运维工作的量来实现的，而把额外超出的工作交给产品开发团队：重新安排bugs和日常需求给开发经理，把开发人员也变成了随叫随到的一个角色（之前只有运维是7*24小时，随叫随到）。当SRE工程师的运维工作量低于50%的时候，这些额外的工作就不会交给产品开发团队了。同时这也提供了一种有效的反馈机制来指导产品开发者开发不用人工干预的系统。当整个团队（包括SRE和开发）理解了为什么这个安全阀机构（SRE团队）存在，并且支持由于产品系统需要更少的人工操作而带来更少的事故的目标的时候这种方式非常奏效。

&emsp;当SRE工程师专注于运维工作的时候,他们最多会轮班处理2个事件每8-12小时.这个工作量安排让他们拥有足够的时间准确快速地处理事件,下线和恢复一般的服务,然后做事件总结.如果SRE工程师值班的时候经常处理超过2个事件,那么事件不会完全地调查清楚,工程师也会因为负担过重而让他们不能很好地从该事故中吸取经验.寻呼机疲劳的场景也不会得到改善.反过来,如果SRE工程师每次值班的时候处理被安排的事件少于1件的话,这样的话也是浪费他们的事件.

&emsp;不管有没有被通报,事故报告应该被记录下来;因为越是没有被通报的事故越是有价值,因为它们指出了我们的监控空白.这份报告应该说明事故具体是什么,造成事故的根源是什么,并有具体的行动来改正问题,下一次遇到类似问题该如何处理.在谷歌,我们拥有事后剖析免责文化,事后剖析免责是一条非常重要的规定，只要有一个客户受停机影响，我们都会举行一个事后剖析会议。就像 John Allspaw和其它人员广泛描述的那样，事后剖析的目标并不是为了追责，而是创造学习的机会和跨公司的广泛交流。我发现，如果公司文化中事后剖析不会引发什么责任性后果，那么会产生惊人的动力，工程师互相“攀比”，看谁捅出过更大的娄子。这将产生大规模的公司性学习，并且正如 Dr. Steven Spear所描述的：这样的做法使得我们在灾难性后果发生之前，可以不断找到并解决问题。我认为其有效原因在于，我们内心里都是工程师，都喜欢建立并改善系统，而让问题暴露出来的公司环境，造就了激动人心和令人满意的工作环境。

#### 在不破坏服务的SLO前提下追求最快速度的改变

&emsp;产品研发团队和SRE团队可以通过消除不同的团队目标带来的冲突来享受高产出的团队关系.团队结构冲突是在创新步伐和产品稳定性,就像之前所说的,这些冲突经常间接地表现出来.在SRE团队,我们先找出这些冲突然后通过引入"错误预算"来解决它.

&emsp;"错误预算"源于这样的观察报告,对于大多数事情来说100%可靠是错误的目标(除非心脏起搏器和防抱死制动系统).总的来数,对于任何软件服务和系统,100%可靠是错误的目标因为没有任何用户可以明显区分100%可靠还是99.999%可靠.在用户和服务之前有许多其它的系统(比如他们的笔记本,家里的WiFi,网络运营商等),很明显地他们的服务可靠性远远低于99.999%.这样说来,99.999%可用和100%可用的边际不同会沉浸于其它服务的不可靠性,而且用户从我们为这0.01%的可靠性付出的巨大努力中感受不到任何好处.

&emsp;对于一个系统来说,如果100%可靠性是是错误的目标,那么什么是对的目标呢?这根本不是技术问题,这是产品层面的问题,应该考虑下面几点:

* 鉴于他们怎么使用产品,哪一个服务级别用户会开心呢?

* 当用户对产品的可用性不满意时,我们能提供什么可选的方案吗?

* 不同的服务可用等级对用户在使用产品上有什么不同?

&emsp;业务或者是产品必须建立在系统稳定性之上的.服务稳定性的目标一旦建立,"错误预算"就是1减去"服务可用性目标".一个服务99.99%可用,就是0.01%不可用.这种允许服务0.01%不可用就是服务的"错误预算".我们可以在任何事情上使用何种"错误预算",只要我们不过度使用.

&emsp;那么我们怎么制定"错误预算"指标呢?产品开发团队想要开发上线新功能来吸引新用户.理想情况下,我们应该设定我们所有的错误指标在新上线的东西上以便他们上线的更快.这个基本前提描述了整个"错误预算"模型.只要SRE团队的所作所为在这个概念指导下,通过分步推出和1%的实验来作为错误预算可以优化快速上线.

&emsp;通过使用"错误预算"机制可以解决开发和SRE的团队结构性冲突.SRE团队的目标不再是"零宕机";相反,SRE团队和产品开发团队一起通过"错误预算"机制来获得更快的新功能上线速度.这种机制非常管用."服务宕机"从来不是一件坏事请--它是创新过程意料之中的一部分,偶尔的发生开发团队和SRE团队一起处理而不是感到恐惧.

#### 监控

&emsp;监控是服务拥有者对自己服务健康状况和可用性了解的主要途径之一.因此,监控策略应该精心设计.一般常用的监控方法是监控一个指定的阀值,当超过或者低于这个阀值的时候就会触发邮件或者短信.然而,邮件报警这种方式不是一种高效的解决方式:一个通过人们看邮件来决定是否采取行动的系统从根本上来说是有缺陷的.监控从来就不应该依靠人去翻译报警内容的任何部分.相反,翻译识别报警内容应该让程序来做,并且只有当需要人工插手解决的时候才应该被通知.有三种可用的报警形式:

* 警报(这里应该指报警短信), 发生这种报警意味着相关负责人应该采取紧急行动来处理已经发生或即将发生的事故.

* 工作流,这种情况下代表相关负责人应该采取行动,但不是很紧急.系统不会自动解决这个问题,相关负责人稍微处理一下就不会有大问题发生.

* 日志, 不用人们手工介入,只是为了调试或者留着以后出问题的时候查看.一般不用查看除非有一些问题需要查日志的时候看看.

#### 紧急响应

&emsp;可靠性跟平均失效时间和平均故障恢复时间紧密相关.在评估应急反应的有效性中最重要的是相关团队能够多快速地把服务恢复正常.就是从出现故障到修复中间的这段时间,MTTR越短表示易恢复性越好。

&emsp;人工介入会增加延迟性.及时给定一个经历过很多实际失败的系统(这里想说明给定的系统经历过了很多失败,已经很稳定了),没有人工干预的情况下会比需要人工干预的情况下更能避免紧急事故.当遇到必须要人工介入的问题的时候,我们发现事前充分考虑并记录问题的最佳解决办法会比"即兴发挥"(这里是指遇到什么问题就从随即上网查或靠记忆去解决问题)在平均故障修复时间上粗暴地缩短3倍.随叫随到的牛逼工程师可以解决问题,但是拥有故障记录手册的有经验的工程师会做的更好.故障记录手册虽然不像剧本,不管它有多么的宽泛,对一个优秀的工程师扩展思路也是很好的帮手,彻底排除故障的步骤和技巧在应对高风险或对时间敏感的事件上也是很有价值的。因此,谷歌的SRE团队是除了"不幸之轮"(灾演)的训练之外还依赖故障记录手册来应对紧急事故的.

#### 变更管理

&emsp;SRE团队发现大概70%的问题出现是因为动态地更改服务器的配置(这里指直接在生产环境更改).这个领域的最佳实践是自动化地完成以下工作:

* 实现滚动式的更改推进
* 快速精确的问题检测
* 当问题出现的时候能安全地进行回滚

这一系列的实践有效地减少了因为用户手动变更带来的问题的总量.通过减少整个过程中的人工插入,有效地避免了因为人员劳累,由于重复性工作而粗心大意带来的问题.通过以上的举措带来了发版速度和安全性都有很大提升.

#### 需求预测与容量规划

&emsp;需求预测和容量规划的目的是确保有足够的资源来满足于未来的需求.这些观念一般是没有什么特别之处,除非有惊人数量的服务和团队没有采取必要的步骤来确保必要的资源在需要的时候已就绪.容量规划既应该考虑有机增长(源于常规的产品服务被用户的使用情况)和无机增长(源于一些事件像新功能上线,市场推广或者是其它的商业推动的改变).

&emsp;容量规划过程中有一些步骤是必要的:

* 准确的有机需求预测,这超出了获取容量所需的交付周期
* 准确的无机需求预测
* 定期的系统负载测试来让系统资源(磁盘,CPU,等)满足服务的需求

&emsp;因为容量对可用性来说是很关键的,所以很自然地SRE团队必须负责容量规划,也就意味着SRE团队也要负责`服务开通`.

#### 服务开通([provisioning](https://zh.wikipedia.org/wiki/%E6%9C%8D%E5%8A%A1%E5%BC%80%E9%80%9A))

服务开通包括了变更管理和硬件资源规划.通过我们的经验,服务开通必须被快速处理和只有必要的时候来操作,因为硬件资源(capacity)是很昂贵的.这些操作必须被正确执行,否则在需要的时候它不能工作.增加新的机器经常会涉及起一个新的实例或者是区域(location 这里我理解为起一个新的机房),对现有系统造成很大改动(配置文件,负载均衡,网络),同时也要检查确保新的设备运转正常.因此它是一个比负载转移风险更高的操作,负载转移经常每小时操作好多次,并且这些操作必须有相应的额外的警戒指标.

#### 效率和性能

&emsp;任何时候高效地使用资源是非常重要的,因为每一个服务都涉及到金钱.因为SRE团队基本上控制了服务开通,这肯定会涉及资源使用,因为资源使用是一种了解给定服务怎样工作和如何被开通的方式.
